<!-- BEGIN_TF_DOCS -->

###### Last Updated[DD/MM/YYYY]: 10/11/2022

## Introduction

Manages a Azure Load Balancer. We can add multiple ip configurations to the load balancer. Supports all the additional load balancer resources such as backend address pool, backend address pool address, nat pool, nat rule, outbound rule, load balancing rule, probe

## File Structure

This particular module is having the following configuration files.

- loadbalancer.tf : This file is having the terraform code to provision the resources as per requirements.
- variables.tf : This file consists of all the variable definitions needed for the terraform code mentioned in loadbalancer.tf.
- outputs.tf : This file will be having the resource output details generated.
- load_balancing_rules.csv : This file contains the load balancing rules in a csv format.
- outbound_rules.csv : This file contains the outbound rules in a csv format.
- nsg_rules.csv: This file contains the nsg rules in a csv format.

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | n/a     |

## Resources

| Name                                                                                                                                                                                    | Type     |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [azurerm_lb.azlb](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb)                                                                                   | resource |
| [azurerm_lb_backend_address_pool.backend_address_pool](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_backend_address_pool)                         | resource |
| [azurerm_lb_backend_address_pool_address.backend_address_pool_address](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_backend_address_pool_address) | resource |
| [azurerm_lb_nat_pool.nat_pool](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_nat_pool)                                                             | resource |
| [azurerm_lb_nat_rule.nat_rule](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_nat_rule)                                                             | resource |
| [azurerm_lb_outbound_rule.outbound_rule](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_outbound_rule)                                              | resource |
| [azurerm_lb_probe.probe](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_probe)                                                                      | resource |
| [azurerm_lb_rule.rule](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/lb_rule)                                                                         | resource |

## Inputs

| Name                                                                                                                                                      | Description                                                                                                                                                                                                                                                                                                                                            | Type                                                                                                                                                                                                                                                                                                                                                                                                | Default      | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | :------: |
| <a name="input_backend_address_pool_addresses"></a> [backend_address_pool_addresses](#input_backend_address_pool_addresses)                               | Specifies the backend address pool address which we can typically use for the load balancer. The optional values for backend_address_pool_addresses are backend_address_pool_address_ip_address, backend_address_pool_address_virtual_network_id, backend_address_pool_address_backend_address_ip_configuration_id for which null value can be passed. | <pre>map(object({<br> backend_address_pool_address_ip_address = string,<br> backend_address_pool_address_virtual_network_id = string,<br> backend_address_pool_address_backend_address_ip_configuration_id = string,<br> backend_address_pool_address_backend_address_pool_id = string<br> }))</pre>                                                                                                | `null`       |    no    |
| <a name="input_backend_address_pools"></a> [backend_address_pools](#input_backend_address_pools)                                                          | Specifies the backend address pools which we can typically used for the load balancer. The optional values in case of the backend_addres_pool is backend_pool_tunnel_interface for which null can be passed.                                                                                                                                           | <pre>map(object({<br> backend_pool_tunnel_interface = list(object({<br> pool_identifier = number,<br> pool_type = string,<br> pool_protocol = string,<br> pool_port = string<br> }))<br> }))</pre>                                                                                                                                                                                                  | `null`       |    no    |
| <a name="input_backend_address_pools_addresses_required"></a> [backend_address_pools_addresses_required](#input_backend_address_pools_addresses_required) | A boolean flag determining whether backend address pools addresses are required or not                                                                                                                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_backend_address_pools_required"></a> [backend_address_pools_required](#input_backend_address_pools_required)                               | A boolean flag determining whether backend address pools are required or not                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_edge_zone"></a> [edge_zone](#input_edge_zone)                                                                                              | (Optional) Specifies the Edge Zone within the Azure Region where this Load Balancer should exist. Changing this forces a new Load Balancer to be created.                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                            | `null`       |    no    |
| <a name="input_frontend_ip_configuration"></a> [frontend_ip_configuration](#input_frontend_ip_configuration)                                              | (Optional) One or multiple frontend_ip_configuration blocks as documented below. The optional values in case of the frontend ip configuration are zones, gateway_load_balancer_frontend_ip_configuration, private_ip_address_allocation, public_ip_address_id, public_ip_prefix_id for which null can be passed.                                       | <pre>map(object({<br> name = string,<br> zones = list(string),<br> subnet_id = string,<br> gateway_load_balancer_frontend_ip_configuration_id = string,<br> private_ip_address = string,<br> private_ip_address_allocation = string,<br> private_ip_address_version = string,<br> public_ip_address_id = string,<br> public_ip_prefix_id = string<br> }))</pre>                                     | n/a          |   yes    |
| <a name="input_lb_name"></a> [lb_name](#input_lb_name)                                                                                                    | (Required) Specifies the name of the Load Balancer.                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_lb_sku"></a> [lb_sku](#input_lb_sku)                                                                                                       | (Optional) The SKU of the Azure Load Balancer. Accepted values are Basic, Standard and Gateway. Defaults to Basic.                                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                            | `"Basic"`    |    no    |
| <a name="input_lb_sku_tier"></a> [lb_sku_tier](#input_lb_sku_tier)                                                                                        | (Optional) The SKU tier of this Load Balancer. Possible values are Global and Regional. Defaults to Regional. Changing this forces a new resource to be created.                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                            | `"Regional"` |    no    |
| <a name="input_load_balancing_rules_file_path"></a> [load_balancing_rules_file_path](#input_load_balancing_rules_file_path)                               | The file path for the load balancing rules                                                                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_load_balancing_rules_required"></a> [load_balancing_rules_required](#input_load_balancing_rules_required)                                  | A boolean flag determining whether load balancing rules are required or not                                                                                                                                                                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_location"></a> [location](#input_location)                                                                                                 | (Required) Specifies the supported Azure Region where the Load Balancer should be created.                                                                                                                                                                                                                                                             | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_nat_pools"></a> [nat_pools](#input_nat_pools)                                                                                              | Specifies the nat pools which we can typically used for the load balancer. The optional values for nat_pools are lb_nat_pool_idle_timeout_in_minutes, lb_nat_pool_floating_ip_enabled, lb_nat_pool_tcp_reset_enabled for which null value can be passed.                                                                                               | <pre>map(object({<br> lb_nat_pool_protocol = string,<br> lb_nat_pool_frontend_port_start = number,<br> lb_nat_pool_frontend_port_end = number,<br> lb_nat_pool_backend_port = number,<br> lb_nat_pool_idle_timeout_in_minutes = number,<br> lb_nat_pool_floating_ip_enabled = bool,<br> lb_nat_pool_tcp_reset_enabled = bool,<br> lb_nat_pool_frontend_ip_configuration_name = string<br> }))</pre> | `null`       |    no    |
| <a name="input_nat_pools_required"></a> [nat_pools_required](#input_nat_pools_required)                                                                   | A boolean flag determining whether nat pools are required or not                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_nat_rules_file_path"></a> [nat_rules_file_path](#input_nat_rules_file_path)                                                                | The file path for the nat rules csv                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_nat_rules_required"></a> [nat_rules_required](#input_nat_rules_required)                                                                   | A boolean flag determining whether nat rules required or not                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_outbound_rules_file_path"></a> [outbound_rules_file_path](#input_outbound_rules_file_path)                                                 | The file path for the outbound rules csv                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_outbound_rules_required"></a> [outbound_rules_required](#input_outbound_rules_required)                                                    | A boolean flag determining whether outbound rules are required or not                                                                                                                                                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_probe_required"></a> [probe_required](#input_probe_required)                                                                               | A boolean flag determining whether probe are required or not                                                                                                                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_probes"></a> [probes](#input_probes)                                                                                                       | Specifies the different health probes which can be attached to the resource. The optional values for probes are probe_request_path, probe_interval_in_seconds, number_of_probes, probe_protocol for which null value can be passed.                                                                                                                    | <pre>map(object(<br> {<br> probe_port = number,<br> probe_request_path = string,<br> probe_interval_in_seconds = number,<br> number_of_probes = number<br> probe_protocol = string<br> }<br> ))</pre>                                                                                                                                                                                               | `null`       |    no    |
| <a name="input_public_load_balancer_required"></a> [public_load_balancer_required](#input_public_load_balancer_required)                                  | A boolean flag defining whether a public load balancer is required or private                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_resource_group_name"></a> [resource_group_name](#input_resource_group_name)                                                                | (Required) The name of the Resource Group in which to create the Load Balancer.                                                                                                                                                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                            | n/a          |   yes    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                             | (Optional) A mapping of tags to assign to the resource.                                                                                                                                                                                                                                                                                                | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                       | `{}`         |    no    |
| <a name="input_use_nat_rules_frontend_port"></a> [use_nat_rules_frontend_port](#input_use_nat_rules_frontend_port)                                        | The nat rules are getting picked up from csv file. When utilizing the frontend port, not the frontend port start and end set this variable to true so that value can be picked up from csv.                                                                                                                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `false`      |    no    |
| <a name="input_use_nat_rules_frontend_range"></a> [use_nat_rules_frontend_range](#input_use_nat_rules_frontend_range)                                     | The nat rules are getting picked up from csv file. When utilizing the frontend start and end, not the frontend port set this variable to true so that value can be picked up from csv.                                                                                                                                                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                              | `true`       |    no    |

## Outputs

| Name                                               | Description                         |
| -------------------------------------------------- | ----------------------------------- |
| <a name="output_lb_id"></a> [lb_id](#output_lb_id) | The id of the created load balancer |

## Module Usage

module "loadbalancer" {
source = "../../modules/module_loadbalancer"
lb_name = var.lb_name
resource_group_name = var.resource_group_name
location = var.location
edge_zone = var.edge_zone
lb_sku = var.lb_sku
lb_sku_tier = var.lb_sku_tier
tags = var.tags
frontend_ip_configuration = var.frontend_ip_configuration
public_load_balancer_required = var.public_load_balancer_required
backend_address_pools_required = var.backend_address_pools_required
backend_address_pools = var.backend_address_pools
backend_address_pools_addresses_required = var.backend_address_pools_addresses_required
backend_address_pool_addresses = var.backend_address_pool_addresses
probe_required = var.probe_required
probes = var.probes
load_balancing_rules_required = var.load_balancing_rules_required
load_balancing_rules_file_path = var.load_balancing_rules_file_path
outbound_rules_required = var.outbound_rules_required
outbound_rules_file_path = var.outbound_rules_file_path
nat_pools_required = var.nat_pools_required
nat_pools = var.nat_pools
nat_rules_required = var.nat_rules_required
nat_rules_file_path = var.nat_rules_file_path
use_nat_rules_frontend_port = var.use_nat_rules_frontend_port
use_nat_rules_frontend_range = var.use_nat_rules_frontend_range
}

<!-- END_TF_DOCS -->
